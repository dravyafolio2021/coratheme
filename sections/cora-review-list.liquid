{% comment %}
  Cora Review Card Widget — matches provided screenshot
  Features:
  - Reviewer info (avatar, verified badge, stars, date)
  - Review text + "Would recommend"
  - Helpful counter
  - Fully customizable colors and spacing
{% endcomment %}

<section
  id="cora-review-widget-{{ section.id }}"
  class="cora-review-widget"
  style="
    --cl-text: {{ section.settings.text_color }};
    --cl-muted: {{ section.settings.muted_color }};
    --cl-star: {{ section.settings.star_color }};
    --cl-primary: {{ section.settings.primary_color }};
    --cl-heart: {{ section.settings.heart_color }};
    --cl-border: {{ section.settings.border_color }};
  "
>
  <div class="cora-review-widget__inner container">
    {% if section.settings.heading != blank %}
      <h2 class="cora-review-widget__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="cora-review-widget__list">
      {% for block in section.blocks %}
        <article class="cora-review-card" {{ block.shopify_attributes }}>
          <!-- Header -->
          <header class="cora-review-card__header">
            <div class="cora-review-card__avatar">
              {% if block.settings.avatar_image != blank %}
                <img
                  src="{{ block.settings.avatar_image | image_url: width: 64 }}"
                  alt="{{ block.settings.name | escape }}"
                  loading="lazy"
                >
              {% else %}
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#b0b0b0" stroke-width="1.8">
                  <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
                </svg>
              {% endif %}
            </div>

            <div class="cora-review-card__meta">
              <div class="meta-row">
                <div class="meta-row_name">
                  <span class="cora-review-card__name">{{ block.settings.name }}</span>
                  {% if block.settings.verified %}
                    <span class="cora-review-card__verified-badge">
                      <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.98985 2.66406L7.10207 5.3274H3.55095L4.43873 8.87853L1.77539 10.6541L4.43873 12.4296L3.55095 15.9808H7.10207L7.98985 18.6441L10.6532 16.8686L13.3165 18.6441L14.2043 15.9808H17.7554L16.8677 12.4296L19.531 10.6541L16.8677 8.87853L17.7554 5.3274H14.2043L13.3165 2.66406L10.6532 4.43962L7.98985 2.66406ZM14.2043 7.10297L15.0921 7.99075L8.87764 14.2052L6.21429 11.5419L7.10207 10.6541L8.87764 12.4296L14.2043 7.10297Z" fill="#0A9EE2"/>
                      </svg>
                    </span>
                  {% endif %}
                </div>

                <span class="cora-review-card__verified-text">{{ section.settings.verified_label }}</span>
              </div>
            </div>
          </header>

          <div class="cora-review-card__text_parent">
            <div class="cora-review-card_clara">
              <span class="cora-review-card__stars">
                {% assign r = block.settings.rating | plus: 0 %}
                {% for i in (1..5) %}
                  {% if i <= r %}★{% else %}☆{% endif %}
                {% endfor %}
              </span>
              <div class="cora-review-card__date">
                <span>{{ block.settings.date }}</span>
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <path d="M14.2045 2.66406C14.4307 2.66431 14.6484 2.75096 14.8129 2.90629C14.9775 3.06163 15.0765 3.27393 15.0897 3.49981C15.103 3.7257 15.0295 3.94813 14.8843 4.12165C14.739 4.29517 14.533 4.40668 14.3083 4.43341L14.2045 4.43962V8.66901L15.8859 12.0328C15.9324 12.1249 15.9624 12.2243 15.9747 12.3267L15.98 12.4296V14.2052C15.98 14.4227 15.9002 14.6325 15.7557 14.795C15.6112 14.9575 15.4121 15.0613 15.1961 15.0868L15.0922 15.093H11.5411V18.6441C11.5409 18.8704 11.4542 19.088 11.2989 19.2526C11.1436 19.4171 10.9313 19.5161 10.7054 19.5294C10.4795 19.5426 10.2571 19.4692 10.0835 19.3239C9.91002 19.1787 9.7985 18.9727 9.77178 18.748L9.76556 18.6441V15.093H6.21444C5.99699 15.093 5.78712 15.0131 5.62462 14.8686C5.46213 14.7241 5.35832 14.525 5.33287 14.3091L5.32666 14.2052V12.4296C5.32678 12.3267 5.34481 12.2246 5.37993 12.1278L5.42076 12.0328L7.10222 8.66723V4.43962C6.87594 4.43937 6.6583 4.35273 6.49376 4.19739C6.32923 4.04206 6.23021 3.82976 6.21695 3.60387C6.20369 3.37798 6.27718 3.15556 6.42242 2.98204C6.56765 2.80852 6.77366 2.697 6.99835 2.67028L7.10222 2.66406H14.2045Z" fill="#DCC14C"/>
                </svg>
              </div>
            </div>
            <!-- Review Text -->
            <p class="cora-review-card__text">{{ block.settings.review }}</p>
            <div class="cora-review-card_clara">
              {% if block.settings.recommend %}
                <p class="cora-review-card__recommend">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="{{ section.settings.heart_color }}">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5c0-2.5 2-4.5 4.5-4.5 1.74 0 3.41 1.01 4.22 2.52C11.09 5.01 12.76 4 14.5 4 17 4 19 6 19 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                  </svg>
                  {{ section.settings.recommend_label }}
                </p>
              {% endif %}

              <!-- Footer -->
              <footer class="cora-review-card__footer">
                <button class="cora-review-card__helpful" data-helpful>
                  {{ section.settings.helpful_label }}
                  <span class="count" data-helpful-count>{{ block.settings.helpful_count | default: 0 }}</span>
                </button>
              </footer>
            </div>
          </div>
        </article>
      {% endfor %}
    </div>
  </div>
</section>
<style>
  #cora-review-widget-{{ section.id }} {
    color: var(--cl-text);
  }
</style>
{{ 'cora-reviews-list.css' | asset_url | stylesheet_tag }}

<script>
  (() => {
    const widget = document.getElementById('cora-review-widget-{{ section.id }}');
    if (!widget) return;
    widget.querySelectorAll('[data-helpful]').forEach((btn) => {
      btn.addEventListener('click', () => {
        const countEl = btn.querySelector('[data-helpful-count]');
        const val = parseInt(countEl.textContent || '0', 10) + 1;
        countEl.textContent = val;
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Cora Review Card Widget",
  "class": "cora-section cora-review-widget",
  "settings": [
    { "type": "text", "id": "heading", "label": "Section Heading", "default": "Customer Reviews" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#160E26" },
    { "type": "color", "id": "muted_color", "label": "Muted Color", "default": "#6b6b6b" },
    { "type": "color", "id": "star_color", "label": "Star Color", "default": "#F6B100" },
    { "type": "color", "id": "primary_color", "label": "Verified Badge Color", "default": "#0070f3" },
    { "type": "color", "id": "heart_color", "label": "Heart Icon Color", "default": "#c23a67" },
    { "type": "color", "id": "border_color", "label": "Border Color", "default": "#e5e3ed" },
    { "type": "text", "id": "verified_label", "label": "Verified Buyer Label", "default": "Verified Buyer" },
    { "type": "text", "id": "recommend_label", "label": "Recommend Label", "default": "Would recommend" },
    { "type": "text", "id": "helpful_label", "label": "Helpful Label", "default": "Helpful" }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review Card",
      "settings": [
        { "type": "text", "id": "name", "label": "Reviewer Name", "default": "Zarc. C" },
        { "type": "image_picker", "id": "avatar_image", "label": "Avatar (optional)" },
        { "type": "range", "id": "rating", "label": "Rating", "min": 1, "max": 5, "default": 5 },
        { "type": "text", "id": "date", "label": "Date", "default": "4 Months ago" },
        {
          "type": "textarea",
          "id": "review",
          "label": "Review Text",
          "default": "Didn’t feel much for the first couple of weeks and was about to give up, but around day 18 I noticed some subtle changes. Wish it had kicked in sooner—it takes patience, which not everyone has."
        },
        { "type": "checkbox", "id": "verified", "label": "Show Verified Badge", "default": true },
        { "type": "checkbox", "id": "recommend", "label": "Show 'Would recommend'", "default": true },
        { "type": "number", "id": "helpful_count", "label": "Helpful Count", "default": 3 }
      ]
    }
  ],
  "presets": [{ "name": "Cora Review Card Widget", "category": "Zenmies" }]
}
{% endschema %}
