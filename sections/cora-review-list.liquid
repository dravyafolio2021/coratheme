{% comment %}
  Cora Review Card Widget — matches provided screenshot
  Features:
  - Reviewer info (avatar, verified badge, stars, date)
  - Review text + "Would recommend"
  - Helpful counter
  - Fully customizable colors and spacing
{% endcomment %}

<section
  id="cora-review-widget-{{ section.id }}"
  class="cora-review-widget"
  style="
    --cl-text: {{ section.settings.text_color }};
    --cl-muted: {{ section.settings.muted_color }};
    --cl-star: {{ section.settings.star_color }};
    --cl-primary: {{ section.settings.primary_color }};
    --cl-heart: {{ section.settings.heart_color }};
    --cl-border: {{ section.settings.border_color }};
  "
>
  <div class="cora-review-widget__inner container">
    {% if section.settings.heading != blank %}
      <h2 class="cora-review-widget__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="cora-review-widget__list">
      {% for block in section.blocks %}
        <article class="cora-review-card" {{ block.shopify_attributes }}>
          <!-- Header -->
          <header class="cora-review-card__header">
            <div class="cora-review-card__avatar">
              {% if block.settings.avatar_image != blank %}
                <img
                  src="{{ block.settings.avatar_image | image_url: width: 64 }}"
                  alt="{{ block.settings.name | escape }}"
                  loading="lazy"
                >
              {% else %}
                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#b0b0b0" stroke-width="1.8">
                  <circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 4-6 8-6s8 2 8 6"/>
                </svg>
              {% endif %}
            </div>

            <div class="cora-review-card__meta">
              <div class="meta-row">
                <span class="cora-review-card__name">{{ block.settings.name }}</span>
                {% if block.settings.verified %}
                  <span class="cora-review-card__verified-badge">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="{{ section.settings.primary_color }}">
                      <path d="M12 2l2.4 2.4 3.6-.8-.8 3.6 2.4 2.4-2.4 2.4.8 3.6-3.6-.8L12 22l-2.4-2.4-3.6.8.8-3.6-2.4-2.4 2.4-2.4-.8-3.6 3.6.8L12 2z"/><path fill="#fff" d="M10.4 13.6l-1.8-1.8 1.2-1.2 0.6 0.6 2.4-2.4 1.2 1.2z"/>
                    </svg>
                  </span>
                  <span class="cora-review-card__verified-text">{{ section.settings.verified_label }}</span>
                {% endif %}
                <span class="cora-review-card__stars">
                  {% assign r = block.settings.rating | plus: 0 %}
                  {% for i in (1..5) %}
                    {% if i <= r %}★{% else %}☆{% endif %}
                  {% endfor %}
                </span>
              </div>
              <div class="cora-review-card__date">
                <span>{{ block.settings.date }}</span>
                <svg width="12" height="12" viewBox="0 0 24 24" fill="{{ section.settings.star_color }}">
                  <path d="M12 2L14.4 8.4H21L15.6 12.6L18 19L12 15L6 19L8.4 12.6L3 8.4H9.6L12 2Z"/>
                </svg>
              </div>
            </div>
          </header>

          <!-- Review Text -->
          <p class="cora-review-card__text">{{ block.settings.review }}</p>

          {% if block.settings.recommend %}
            <p class="cora-review-card__recommend">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="{{ section.settings.heart_color }}">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5c0-2.5 2-4.5 4.5-4.5 1.74 0 3.41 1.01 4.22 2.52C11.09 5.01 12.76 4 14.5 4 17 4 19 6 19 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
              </svg>
              {{ section.settings.recommend_label }}
            </p>
          {% endif %}

          <!-- Footer -->
          <footer class="cora-review-card__footer">
            <button class="cora-review-card__helpful" data-helpful>
              {{ section.settings.helpful_label }}
              <span class="count" data-helpful-count>{{ block.settings.helpful_count | default: 0 }}</span>
            </button>
          </footer>
        </article>
      {% endfor %}
    </div>
  </div>
</section>
<style>
  #cora-review-widget-{{ section.id }} {
    color: var(--cl-text);
  }
</style>
{{ 'cora-reviews-list.css' | asset_url | stylesheet_tag }}

<script>
  (() => {
    const widget = document.getElementById('cora-review-widget-{{ section.id }}');
    if (!widget) return;
    widget.querySelectorAll('[data-helpful]').forEach((btn) => {
      btn.addEventListener('click', () => {
        const countEl = btn.querySelector('[data-helpful-count]');
        const val = parseInt(countEl.textContent || '0', 10) + 1;
        countEl.textContent = val;
      });
    });
  })();
</script>

{% schema %}
{
  "name": "Cora Review Card Widget",
  "class": "cora-section cora-review-widget",
  "settings": [
    { "type": "text", "id": "heading", "label": "Section Heading", "default": "Customer Reviews" },
    { "type": "color", "id": "text_color", "label": "Text Color", "default": "#160E26" },
    { "type": "color", "id": "muted_color", "label": "Muted Color", "default": "#6b6b6b" },
    { "type": "color", "id": "star_color", "label": "Star Color", "default": "#F6B100" },
    { "type": "color", "id": "primary_color", "label": "Verified Badge Color", "default": "#0070f3" },
    { "type": "color", "id": "heart_color", "label": "Heart Icon Color", "default": "#c23a67" },
    { "type": "color", "id": "border_color", "label": "Border Color", "default": "#e5e3ed" },
    { "type": "text", "id": "verified_label", "label": "Verified Buyer Label", "default": "Verified Buyer" },
    { "type": "text", "id": "recommend_label", "label": "Recommend Label", "default": "Would recommend" },
    { "type": "text", "id": "helpful_label", "label": "Helpful Label", "default": "Helpful" }
  ],
  "blocks": [
    {
      "type": "review",
      "name": "Review Card",
      "settings": [
        { "type": "text", "id": "name", "label": "Reviewer Name", "default": "Zarc. C" },
        { "type": "image_picker", "id": "avatar_image", "label": "Avatar (optional)" },
        { "type": "range", "id": "rating", "label": "Rating", "min": 1, "max": 5, "default": 5 },
        { "type": "text", "id": "date", "label": "Date", "default": "4 Months ago" },
        {
          "type": "textarea",
          "id": "review",
          "label": "Review Text",
          "default": "Didn’t feel much for the first couple of weeks and was about to give up, but around day 18 I noticed some subtle changes. Wish it had kicked in sooner—it takes patience, which not everyone has."
        },
        { "type": "checkbox", "id": "verified", "label": "Show Verified Badge", "default": true },
        { "type": "checkbox", "id": "recommend", "label": "Show 'Would recommend'", "default": true },
        { "type": "number", "id": "helpful_count", "label": "Helpful Count", "default": 3 }
      ]
    }
  ],
  "presets": [{ "name": "Cora Review Card Widget", "category": "Zenmies" }]
}
{% endschema %}
